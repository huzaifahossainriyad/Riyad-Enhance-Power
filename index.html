<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riyad Enhance Power</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.20.0",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/"
  }
}
</script>
</head>
<body class="bg-gray-900 font-sans">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useCallback } from 'https://aistudiocdn.com/react@^19.1.1';
        import ReactDOM from 'https://aistudiocdn.com/react-dom@^19.1.1/client';
        import { GoogleGenAI, Modality } from 'https://aistudiocdn.com/@google/genai@^1.20.0';

        // --- Gemini Service Logic ---
        const API_KEY = process.env.API_KEY;
        
        const ai = API_KEY ? new GoogleGenAI({ apiKey: API_KEY }) : null;

        const ENHANCEMENT_PROMPT = `**CRITICAL RULE: DO NOT CHANGE THE PERSON'S IDENTITY.** The face, its structure, and all unique features (eyes, nose, mouth, facial shape) in the output photo must be an exact match to the original. Any alteration of the person's identity is a failure.

Your task is to perform a professional-level photo enhancement based on this critical rule. Apply the following improvements:

1.  **Upscale to Maximum Quality:** Significantly increase the image's resolution and sharpness. The goal is a crystal-clear, high-definition result with photorealistic detail. Eliminate any blurriness or digital noise.
2.  **Professional Skin Retouching:** Perform a detailed and natural skin enhancement. Remove all temporary imperfections like acne, pimples, spots, and redness. Even out the skin tone for a smooth, clean appearance. It is important to preserve the natural skin texture and not make it look artificial or plastic. Do not remove permanent features like moles or scars.
3.  **Advanced Lighting and Color Correction:** Automatically adjust the lighting and exposure for a professional look. Balance highlights and shadows to bring out detail. Correct any color cast and enhance the colors to be vibrant, rich, and true-to-life.

The final image must be a dramatically improved, high-quality version of the original photo, showcasing the same person with flawless clarity and professional polish.`;

        const dataUrlToGeminiPart = (dataUrl) => {
            const match = dataUrl.match(/^data:(.+?);base64,(.+)$/);
            if (!match) throw new Error("Invalid data URL");
            return { inlineData: { mimeType: match[1], data: match[2] } };
        };

        const enhanceImageWithGemini = async (imageDataUrl) => {
            if (!ai) throw new Error("Cannot enhance image: API_KEY is not configured.");
            try {
                const imagePart = dataUrlToGeminiPart(imageDataUrl);
                const response = await ai.models.generateContent({
                    model: 'gemini-2.5-flash-image-preview',
                    contents: { parts: [imagePart, { text: ENHANCEMENT_PROMPT }] },
                    config: { responseModalities: [Modality.IMAGE, Modality.TEXT] },
                });
                
                const imageParts = response.candidates?.[0]?.content?.parts?.filter(part => part.inlineData);
                if (!imageParts || imageParts.length === 0 || !imageParts[0].inlineData) {
                    const textPart = response.candidates?.[0]?.content?.parts?.find(part => part.text)?.text;
                    if (textPart) throw new Error(`Model returned text: ${textPart}`);
                    throw new Error("No enhanced image data found in the response.");
                }

                const enhancedImagePart = imageParts[0].inlineData;
                return `data:${enhancedImagePart.mimeType};base64,${enhancedImagePart.data}`;
            } catch (error) {
                console.error("Error enhancing image with Gemini:", error);
                throw new Error(error instanceof Error ? `Failed to enhance image: ${error.message}` : "An unknown error occurred.");
            }
        };

        // --- UI Components ---
        const Spinner = () => (
            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        );

        const ImagePreview = ({ title, imageUrl, isLoading = false, filter = 'filter-none' }) => (
            <div className="w-full">
                <h2 className="text-xl font-semibold mb-4 text-center text-gray-300">{title}</h2>
                <div className="relative w-full bg-gray-800 rounded-lg aspect-square flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-600">
                    {isLoading && (
                        <div className="absolute inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center z-10">
                            <Spinner />
                            <p className="mt-2 text-lg">Enhancing photo...</p>
                        </div>
                    )}
                    {imageUrl ? (
                        <img 
                            src={imageUrl} 
                            alt={title} 
                            className={`object-contain h-full w-full transition-all duration-300 ${filter}`} 
                        />
                    ) : (
                        <div className="text-gray-500 text-center px-4">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p className="mt-2">{title === 'Original Image' ? 'Upload an image to start' : 'Enhanced image will appear here'}</p>
                        </div>
                    )}
                </div>
            </div>
        );
        
        // --- Main App Component ---
        const FILTERS = [
            { name: 'No Filter', css: 'filter-none' },
            { name: 'Grayscale', css: 'grayscale' },
            { name: 'Sepia', css: 'sepia' },
            { name: 'Invert Colors', css: 'invert' },
            { name: 'Saturate', css: 'saturate-150' },
            { name: 'Contrast', css: 'contrast-125' },
        ];

        const App = () => {
            const [originalImage, setOriginalImage] = useState(null);
            const [enhancedImage, setEnhancedImage] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [selectedFilter, setSelectedFilter] = useState(FILTERS[0].css);

            const handleFileChange = (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
                    setError('Please upload a valid image file (JPEG, PNG, WebP).');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const dataUrl = e.target?.result;
                    setOriginalImage({ file, dataUrl });
                    setEnhancedImage(null);
                    setError(null);
                    setSelectedFilter(FILTERS[0].css);
                };
                reader.readAsDataURL(file);
            };

            const handleEnhance = useCallback(async () => {
                if (!originalImage) return;
                setIsLoading(true);
                setError(null);
                setEnhancedImage(null);
                setSelectedFilter(FILTERS[0].css);
                try {
                    const result = await enhanceImageWithGemini(originalImage.dataUrl);
                    setEnhancedImage(result);
                } catch (err) {
                    setError(err instanceof Error ? err.message : 'An unexpected error occurred.');
                } finally {
                    setIsLoading(false);
                }
            }, [originalImage]);

            const handleDownload = () => {
                if (!enhancedImage) return;
                const link = document.createElement('a');
                link.href = enhancedImage;
                const originalName = originalImage?.file.name.split('.').slice(0, -1).join('.');
                link.download = `${originalName || 'enhanced'}-photo.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
                    <div className="w-full max-w-6xl mx-auto text-white">
                        <header className="text-center mb-8">
                            <h1 className="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                                Akash Computer Shop by Riyad Hossain Huzaifa Photo Enhance
                            </h1>
                            <p className="mt-2 text-lg text-gray-400">
                                Upload your photo and let AI work its magic. Powered by Riyad Power
                            </p>
                        </header>

                        {error && (
                            <div className="bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-lg relative mb-6" role="alert">
                                <strong className="font-bold">Error: </strong>
                                <span className="block sm:inline">{error}</span>
                            </div>
                        )}

                        <main className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <ImagePreview title="Original Image" imageUrl={originalImage?.dataUrl || null} />
                            <div className="flex flex-col gap-4">
                                <ImagePreview
                                    title="Enhanced Image"
                                    imageUrl={enhancedImage}
                                    isLoading={isLoading}
                                    filter={selectedFilter}
                                />
                                {enhancedImage && !isLoading && (
                                    <div className="flex flex-col items-center gap-6 p-4 bg-gray-800 rounded-lg">
                                        <div className="w-full max-w-xs">
                                            <label htmlFor="filter-select" className="block text-sm font-medium text-gray-300 mb-2 text-center">
                                                Apply a Filter
                                            </label>
                                            <select
                                                id="filter-select"
                                                value={selectedFilter}
                                                onChange={(e) => setSelectedFilter(e.target.value)}
                                                className="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                                            >
                                                {FILTERS.map((filter) => (
                                                    <option key={filter.css} value={filter.css}>
                                                        {filter.name}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        <button
                                            onClick={handleDownload}
                                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg flex items-center"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                            </svg>
                                            Download Enhanced Image
                                        </button>
                                    </div>
                                )}
                            </div>
                        </main>

                        <footer className="flex flex-col items-center space-y-4">
                            <div className="flex flex-wrap justify-center gap-4">
                                <label className="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg">
                                    <span>Upload Photo</span>
                                    <input type="file" className="hidden" accept="image/jpeg,image/png,image/webp" onChange={handleFileChange} />
                                </label>
                                <button
                                    onClick={handleEnhance}
                                    disabled={!originalImage || isLoading}
                                    className="bg-purple-600 hover:bg-purple-700 disabled:bg-gray-500 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-lg flex items-center justify-center min-w-[170px]"
                                >
                                    {isLoading && <Spinner />}
                                    {isLoading ? 'Enhancing...' : 'Enhance Photo'}
                                </button>
                            </div>
                        </footer>
                    </div>
                </div>
            );
        };
        
        const ApiKeyMissingScreen = () => (
            <div className="min-h-screen flex flex-col items-center justify-center p-4">
                <div className="w-full max-w-md bg-red-900/50 border border-red-500 rounded-lg p-6 text-center text-white">
                    <h1 className="text-2xl font-bold mb-2">Configuration Error</h1>
                    <p className="text-red-300">The application cannot start because the API_KEY is missing. Please ensure it is configured correctly in your environment.</p>
                </div>
            </div>
        );

        // --- Mount Application ---
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        if (API_KEY) {
            root.render(<App />);
        } else {
            console.error("API_KEY is not set. The application cannot start.");
            root.render(<ApiKeyMissingScreen />);
        }
    </script>
</body>
</html>